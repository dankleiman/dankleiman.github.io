<!DOCTYPE HTML>

<html>
    <head>
        
            
                <title>SQL Quick Tip: Guarantee Rows for Every Date in Your Report</title>
            
        

        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="generator" content="Hugo 0.19-DEV" />
        


        
        
            
                <meta name="description" content="Tai Chi, Code, and Whatever from Dan Kleiman">
            
        

        

  <meta name="twitter:card" content="summary"/>



<meta name="twitter:title" content="SQL Quick Tip: Guarantee Rows for Every Date in Your Report"/>
<meta name="twitter:description" content="When you are reporting on metrics over time, sometimes your data will have missing entries on certain days.

In these cases, it&rsquo;s useful to be able to ensure that every date shows up in your report, regardless of whether or not there is a metric in the dataset for that date.

Let&rsquo;s use daily user logins to a website for a reporting metric to illustrate how you solve this problem.

"/>
<meta name="twitter:site" content="@Dan_Kleiman"/>


        <meta property="og:title" content="SQL Quick Tip: Guarantee Rows for Every Date in Your Report" />
<meta property="og:description" content="When you are reporting on metrics over time, sometimes your data will have missing entries on certain days.

In these cases, it&rsquo;s useful to be able to ensure that every date shows up in your report, regardless of whether or not there is a metric in the dataset for that date.

Let&rsquo;s use daily user logins to a website for a reporting metric to illustrate how you solve this problem.

" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://dankleiman.com/2019/09/12/sql-quick-tip-guarantee-rows-for-every-date-in-your-report" />



<meta property="article:published_time" content="2019-09-12T21:57:02-04:00"/>
<meta property="article:modified_time" content="2019-09-12T21:57:02-04:00"/>











        
<meta itemprop="name" content="SQL Quick Tip: Guarantee Rows for Every Date in Your Report">
<meta itemprop="description" content="When you are reporting on metrics over time, sometimes your data will have missing entries on certain days.

In these cases, it&rsquo;s useful to be able to ensure that every date shows up in your report, regardless of whether or not there is a metric in the dataset for that date.

Let&rsquo;s use daily user logins to a website for a reporting metric to illustrate how you solve this problem.

">


<meta itemprop="dateModified" content="2019-09-12T21:57:02-04:00" />
<meta itemprop="wordCount" content="1155">



<meta itemprop="keywords" content="BTC,BigQuery,Code,Courses and Events,Energy Arts,Events,Golang,Inner Form,Launch Academy,Learning,Meditation,Movement Practice,Octopress,Practice People,Practice Tip,Psychology,Qigong,Quick Tip,Rails,RailsConf,Ruby,SQL,Security,Sinatra,Site,Small Business,Static Sites,Tai Chi,Trainerfly,Twilio,Xing Yi,1000 True Fans,5 Elements,An,BC,BJ Fogg,Ba Gua,Balance,Behavior Change,Bend the Bow,Bill Ryan,Breathing,Breathing Exercise,Breathing For Relaxation,Brookline Tai Chi,Bruce Frantzis,Bruce Lee,Business Tools,Cathy Kerr,Central Equilibrium,Cheng Man Ching,Chi,Chicago Tai Chi,Chinese Medicine,Cloud Hands,Conflict Resolution,Creativity,Crossfit,DPH,Daily Practice,David-Dorian Ross,Deliberate Practice,Design,Diaphragmatic Breathing,Don Ethan Miller,Dorothy Fitzer,Dr. Mark Cheng,Dragon and Tiger,Elephant Wrestling,Energies,Energy,Energy Arts,Energy Gates Dissolving Series,Enterprise of One,Entrepreneurship,Exercise Mp3,Eyes,Fall Prevention,Favorite Quotes,Feedback,Feng Zhiqiang,Five Movement Centers,Foundations of Relaxation,Fuzhong Li,Gaming,Gods Playing in the Clouds,Harvard Medical School,Harvard Medical School Guide,Health Month,Heath Brothers,Heaven and Earth,Hot Triggers,Immersion,Inc. Magazine,Inner Form,Inner Game of Tennis,Instructor Training,Intrinsic Motivation,Intuition,Isaac Kamins,Jane McGonigal,Ji,Josh Kaufman,Learning Tai Chi,Lee Scheele,Leverage,Lu,Marriage of Heaven and Earth,Master Wang Hao Da,Medicine,Meditate,Meditation,Meditation Practice,Mobile,Mobility,Moodle,Motivation,Myth of the Overworked Creative,Online Learning,Opening and Closing,Pain,Paul Cavel,Peng,Perfect Practice,Personal MBA,Personal Practice,Peter Wayne,Posture,Product Launch,Productivity,Pulsing,Push Hands,Qi,Qigong,Qigong Breathing,Qigong Practice,Qigong Radio,Qigong Youtube,Quantity,Ramit Sethi,Rhythm,Robert Tangora,Running a school,San Ti,Seasonal Practice,Sitting Practice,Spinal Qigong,Spiraling Energy Body,Spiritual Practice,Standing Qigong,Standing Series,Stanford,State of the Art,Stretch,Swing,Swings,Switch,Systems,T&#39;ai Chi Ch&#39;uan,T&#39;ai Chi for Health and Happiness,TED talks,Tai Chi,Tai Chi Classics,Tai Chi Equipment Training,Tai Chi Mastery Program,Tai Chi Postures,Tai Chi Practice,Tai Chi Principles,Tai Chi Research,Tai Chi Teacher,Taoist Arts,TechCrunch,Technology,The Tools,Tony Schwartz,Traditional Chinese Medicine,Trainerfly Backstory,Travel,Vancouver,Vision,Visual Training,Week,Wordpress,Wu Jianquan,Wu Short Form Instructor Training 2011,Yoga,Your Practice,Z Health,alignments,anxiety,case study,chi gung,depression,dissolving,energy gates,energy management,fear,feet,flexibility,four points,joint mobility,kwa,learning,mind,neigong,practice,practice tips,problem solving,relaxation,rooting,seminars,sinking,small business marketing,song,spine,standing,stress,teaching,twisting,xingyi,yin and yang,zhong ding," />

        

        
            
        

        
        
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css">
            <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway:400,800,900|Source+Sans+Pro:400,700">
            <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.25/jquery.fancybox.min.css">
            <link rel="stylesheet" href="https://dankleiman.com/css/main.css">
            <link rel="stylesheet" href="https://dankleiman.com/css/add-on.css">
        

        
            
                
            
        

        
            
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-19970008-2', 'auto');
ga('send', 'pageview');
</script>

        
    </head>
    <body>

      
      <div id="wrapper">

    
    
<header id="header">
    
      <h1><a href="https://dankleiman.com/">post</a></h1>
    

    <nav class="links">
        <ul>
            
                <li>
                    <a href="/">
                            <i class="fa fa-home">&nbsp;</i>Home
                    </a>
                </li>
            
                <li>
                    <a href="/about/">
                            <i class="fa fa-id-card-o">&nbsp;</i>About
                    </a>
                </li>
            
                <li>
                    <a href="/post/">
                            <i class="fa fa-newspaper-o">&nbsp;</i>Blog
                    </a>
                </li>
            
                <li>
                    <a href="/categories/">
                            <i class="fa fa-sitemap">&nbsp;</i>Categories
                    </a>
                </li>
            
        </ul>
    </nav>
    <nav class="main">
        <ul>
            
            <li id="share-nav" class="share-menu" style="display:none;">
                <a class="fa-share-alt" href="#share-menu">Share</a>
            </li>
            
            <li class="search">
                <a class="fa-search" href="#search">Search</a>
                <form id="search" method="get" action="//google.com/search">
                    <input type="text" name="q" placeholder="Search" />
                    <input type="hidden" name="as_sitesearch" value="https://dankleiman.com/">
                </form>
            </li>
            <li class="menu">
                <a class="fa-bars" href="#menu">Menu</a>
            </li>
        </ul>
    </nav>
</header>


<section id="menu">

    
        <section>
            <form class="search" method="get" action="//google.com/search">
                <input type="text" name="q" placeholder="Search" />
                <input type="hidden" name="as_sitesearch" value="https://dankleiman.com/">
            </form>
        </section>

    
        <section>
            <ul class="links">
                
                    <li>
                        <a href="/">
                            <h3>
                                <i class="fa fa-home">&nbsp;</i>Home
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="/about/">
                            <h3>
                                <i class="fa fa-id-card-o">&nbsp;</i>About
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="/post/">
                            <h3>
                                <i class="fa fa-newspaper-o">&nbsp;</i>Blog
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="/categories/">
                            <h3>
                                <i class="fa fa-sitemap">&nbsp;</i>Categories
                            </h3>
                        </a>
                    </li>
                
            </ul>
        </section>

    
        <section id="recent-posts">
            <div class="mini-posts">
                <header>
                    <h3>Recent Posts</h3>
                </header>
                

                
                    
                

                
                        <article class="mini-post">
                            <header>
                                <h3><a href="https://dankleiman.com/2019/10/12/sql-quick-tip-find-the-latest-record-for-each-member-of-a-group">SQL Quick Tip: Find the Latest Record for Each Member of a Group</a></h3>
                                
                                <time class="published" datetime=
                                    '2019-10-12'>
                                    October 12, 2019</time>
                            </header>
                            

                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="https://dankleiman.com/2019/10/06/sql-quick-tip-find-missing-data">SQL Quick Tip: Find Missing Data</a></h3>
                                
                                <time class="published" datetime=
                                    '2019-10-06'>
                                    October 6, 2019</time>
                            </header>
                            

                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="https://dankleiman.com/2019/09/27/sql-quick-tip-showing-changes-in-your-data">SQL Quick Tip: Showing Changes in Your Data</a></h3>
                                
                                <time class="published" datetime=
                                    '2019-09-27'>
                                    September 27, 2019</time>
                            </header>
                            

                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="https://dankleiman.com/2019/09/12/sql-quick-tip-guarantee-rows-for-every-date-in-your-report">SQL Quick Tip: Guarantee Rows for Every Date in Your Report</a></h3>
                                
                                <time class="published" datetime=
                                    '2019-09-12'>
                                    September 12, 2019</time>
                            </header>
                            

                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="https://dankleiman.com/2019/08/30/sql-quick-tip-present-cleaner-results-with-custom-ordering">SQL Quick Tip: Present Cleaner Results with Custom Ordering</a></h3>
                                
                                <time class="published" datetime=
                                    '2019-08-30'>
                                    August 30, 2019</time>
                            </header>
                            

                        </article>
                

                
                    <a href=
                        
                            /post/
                        
                        class="button">View more posts</a>
                
            </div>
        </section>

    
        
</section>

    <section id="share-menu">
    <section id="social-share-nav">
        <ul class="links">
            <header>
                <h3>Share this post <i class="fa fa-smile-o"></i></h3>
            </header>
            


<li>
  <a href="//twitter.com/share?url=https%3a%2f%2fdankleiman.com%2f2019%2f09%2f12%2fsql-quick-tip-guarantee-rows-for-every-date-in-your-report&text=SQL%20Quick%20Tip%3a%20Guarantee%20Rows%20for%20Every%20Date%20in%20Your%20Report&via=Dan_Kleiman" target="_blank" class="share-btn twitter">
    <i class="fa fa-twitter"></i>
    <p>Twitter</p>
    </a>
</li>


<li>
  <a href="//plus.google.com/share?url=https%3a%2f%2fdankleiman.com%2f2019%2f09%2f12%2fsql-quick-tip-guarantee-rows-for-every-date-in-your-report" target="_blank" class="share-btn google-plus">
    <i class="fa fa-google-plus"></i>
    <p>Google+</p>
  </a>
</li>


<li>
  <a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fdankleiman.com%2f2019%2f09%2f12%2fsql-quick-tip-guarantee-rows-for-every-date-in-your-report" target="_blank" class="share-btn facebook">
    <i class="fa fa-facebook"></i>
    <p>Facebook</p>
    </a>
</li>


<li>
  <a href="//reddit.com/submit?url=https%3a%2f%2fdankleiman.com%2f2019%2f09%2f12%2fsql-quick-tip-guarantee-rows-for-every-date-in-your-report&title=SQL%20Quick%20Tip%3a%20Guarantee%20Rows%20for%20Every%20Date%20in%20Your%20Report" target="_blank" class="share-btn reddit">
    <i class="fa fa-reddit-alien"></i>
    <p>Reddit</p>
  </a>
</li>


<li>
  <a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fdankleiman.com%2f2019%2f09%2f12%2fsql-quick-tip-guarantee-rows-for-every-date-in-your-report&title=SQL%20Quick%20Tip%3a%20Guarantee%20Rows%20for%20Every%20Date%20in%20Your%20Report" target="_blank" class="share-btn linkedin">
      <i class="fa fa-linkedin"></i>
      <p>LinkedIn</p>
    </a>
</li>


<li>
  <a href="//www.stumbleupon.com/submit?url=https%3a%2f%2fdankleiman.com%2f2019%2f09%2f12%2fsql-quick-tip-guarantee-rows-for-every-date-in-your-report&title=SQL%20Quick%20Tip%3a%20Guarantee%20Rows%20for%20Every%20Date%20in%20Your%20Report" target="_blank" class="share-btn stumbleupon">
    <i class="fa fa-stumbleupon"></i>
    <p>StumbleUpon</p>
  </a>
</li>


<li>
  <a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fdankleiman.com%2f2019%2f09%2f12%2fsql-quick-tip-guarantee-rows-for-every-date-in-your-report&description=SQL%20Quick%20Tip%3a%20Guarantee%20Rows%20for%20Every%20Date%20in%20Your%20Report" target="_blank" class="share-btn pinterest">
    <i class="fa fa-pinterest-p"></i>
    <p>Pinterest</p>
  </a>
</li>


<li>
  <a href="mailto:?subject=Check out this post by &body=https%3a%2f%2fdankleiman.com%2f2019%2f09%2f12%2fsql-quick-tip-guarantee-rows-for-every-date-in-your-report" target="_blank" class="share-btn email">
    <i class="fa fa-envelope"></i>
    <p>Email</p>
  </a>
</li>

        </ul>
    </section>
</section>

    
    <div id="main">
        
        
        <article class="post">
  <header>
    <div class="title">
        
            <h1><a href="https://dankleiman.com/2019/09/12/sql-quick-tip-guarantee-rows-for-every-date-in-your-report">SQL Quick Tip: Guarantee Rows for Every Date in Your Report</a></h1>
            
        
        
    </div>
    <div class="meta">
        

        <time class="published"
            datetime='2019-09-12'>
            September 12, 2019</time>
        <span class="author"></span>
        
            <p>6 minute read</p>
        
        
    </div>
</header>


  
    <section id="social-share">
      <ul class="icons">
        


<li>
  <a href="//twitter.com/share?url=https%3a%2f%2fdankleiman.com%2f2019%2f09%2f12%2fsql-quick-tip-guarantee-rows-for-every-date-in-your-report&text=SQL%20Quick%20Tip%3a%20Guarantee%20Rows%20for%20Every%20Date%20in%20Your%20Report&via=Dan_Kleiman" target="_blank" class="share-btn twitter">
    <i class="fa fa-twitter"></i>
    <p>Twitter</p>
    </a>
</li>


<li>
  <a href="//plus.google.com/share?url=https%3a%2f%2fdankleiman.com%2f2019%2f09%2f12%2fsql-quick-tip-guarantee-rows-for-every-date-in-your-report" target="_blank" class="share-btn google-plus">
    <i class="fa fa-google-plus"></i>
    <p>Google+</p>
  </a>
</li>


<li>
  <a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fdankleiman.com%2f2019%2f09%2f12%2fsql-quick-tip-guarantee-rows-for-every-date-in-your-report" target="_blank" class="share-btn facebook">
    <i class="fa fa-facebook"></i>
    <p>Facebook</p>
    </a>
</li>


<li>
  <a href="//reddit.com/submit?url=https%3a%2f%2fdankleiman.com%2f2019%2f09%2f12%2fsql-quick-tip-guarantee-rows-for-every-date-in-your-report&title=SQL%20Quick%20Tip%3a%20Guarantee%20Rows%20for%20Every%20Date%20in%20Your%20Report" target="_blank" class="share-btn reddit">
    <i class="fa fa-reddit-alien"></i>
    <p>Reddit</p>
  </a>
</li>


<li>
  <a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fdankleiman.com%2f2019%2f09%2f12%2fsql-quick-tip-guarantee-rows-for-every-date-in-your-report&title=SQL%20Quick%20Tip%3a%20Guarantee%20Rows%20for%20Every%20Date%20in%20Your%20Report" target="_blank" class="share-btn linkedin">
      <i class="fa fa-linkedin"></i>
      <p>LinkedIn</p>
    </a>
</li>


<li>
  <a href="//www.stumbleupon.com/submit?url=https%3a%2f%2fdankleiman.com%2f2019%2f09%2f12%2fsql-quick-tip-guarantee-rows-for-every-date-in-your-report&title=SQL%20Quick%20Tip%3a%20Guarantee%20Rows%20for%20Every%20Date%20in%20Your%20Report" target="_blank" class="share-btn stumbleupon">
    <i class="fa fa-stumbleupon"></i>
    <p>StumbleUpon</p>
  </a>
</li>


<li>
  <a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fdankleiman.com%2f2019%2f09%2f12%2fsql-quick-tip-guarantee-rows-for-every-date-in-your-report&description=SQL%20Quick%20Tip%3a%20Guarantee%20Rows%20for%20Every%20Date%20in%20Your%20Report" target="_blank" class="share-btn pinterest">
    <i class="fa fa-pinterest-p"></i>
    <p>Pinterest</p>
  </a>
</li>


<li>
  <a href="mailto:?subject=Check out this post by &body=https%3a%2f%2fdankleiman.com%2f2019%2f09%2f12%2fsql-quick-tip-guarantee-rows-for-every-date-in-your-report" target="_blank" class="share-btn email">
    <i class="fa fa-envelope"></i>
    <p>Email</p>
  </a>
</li>

      </ul>
    </section>
  

  

  <div id="content">
    <p>When you are reporting on metrics over time, sometimes your data will have missing entries on certain days.</p>

<p>In these cases, it&rsquo;s useful to be able to ensure that every date shows up in your report, regardless of whether or not there is a metric in the dataset for that date.</p>

<p>Let&rsquo;s use daily user logins to a website for a reporting metric to illustrate how you solve this problem.</p>

<p></p>

<p><em>Quick clarification before we dive into the example:</em> I&rsquo;m writing this as a throwaway query on Redshift, but if you&rsquo;re using Postgres there are some sweet shortcuts that make some of the steps below even easier. If you&rsquo;re using something outside of those two database systems, I hope at least the strategies are clear.</p>

<h2 id="group-by-date-sum">Group By Date + Sum</h2>

<p>Our first cut at the data uses a simple <code>GROUP BY</code> and <code>SUM</code> to show the counts per day of user logins:</p>

<pre><code>SELECT
date,
SUM(count) as count
FROM (
  SELECT date, count FROM (SELECT '2019-09-01', 115) as r(date, count)
  UNION ALL
  SELECT date, count FROM (SELECT '2019-09-02', 98) as r2(date,count)
  UNION ALL
  SELECT date, count FROM (SELECT '2019-09-04', 451) as r4(date, count)
  UNION ALL
  SELECT date, count FROM (SELECT '2019-09-05', 239) as r5(date, count)
  UNION ALL
  SELECT date, count FROM (SELECT '2019-09-06', 75) as r6(date, count)
  UNION ALL
  SELECT date, count FROM (SELECT '2019-09-07', 306) as r7(date, count)
)
GROUP BY date
</code></pre>

<p><img src="/img/sparse_graph.png" alt="Missing Dates in Report"></p>

<p>You might see the problem in the sample data in the SQL statement already, but if you look at the dates on the x-axis of the graph, you&rsquo;ll notice that there&rsquo;s no entry for 9/3/2019. According to the data, there were no logins that day. And while that might be true, that&rsquo;s not the best way to report on daily user logins.</p>

<h2 id="what-to-do-about-zero">What To Do About Zero?</h2>

<p>Remember, our goal is to return a full series of dates and login counts for all the days in the report range.</p>

<p>There are alternatives to solving this problem directly in SQL.</p>

<p>You could:</p>

<ul>
<li>fill in the gaps after you get your query results back and before you build the report (a strategy you&rsquo;ll see in a lot of web applications)</li>
<li>ensure that every day has a zero entry in the database for every metric (don&rsquo;t do this)</li>
</ul>

<p>Here, we are going to dynamically fill in the gaps using SQL.</p>

<h2 id="filling-in-the-gaps">Filling in the Gaps</h2>

<p>The key concept you need to keep in mind to fill in the gaps is this: <strong>since your table doesn&rsquo;t have an entry for every date, you need to join on another table that does.</strong></p>

<p>There are 3 ways to get your full date range table:</p>

<ol>
<li>Create a &ldquo;numbers table&rdquo; in your database with all the possible dates you&rsquo;ll ever need</li>
<li>Use a function that generates the date range for you (<a href="https://www.postgresql.org/docs/9.1/functions-srf.html">see <code>generate_series</code> in Postgres</a>)</li>
<li>Generate the range as part of your query by counting rows in another table that is big enough to cover the range you need</li>
</ol>

<p>If that third option sounds like a mouthful, good. Keep reading. That&rsquo;s the one we&rsquo;re going to unpack.</p>

<p>Here&rsquo;s what the &ldquo;full date range&rdquo; query looks like:</p>

<pre><code>WITH dates AS (
  SELECT
    '2019-09-10'::date - ROW_NUMBER() OVER() as date
  FROM
    some_big_enough_table
  LIMIT 14
), logins AS (
  SELECT date, count FROM (SELECT '2019-09-01'::date, 115) as r(date, count)
  UNION ALL
  SELECT date, count FROM (SELECT '2019-09-02'::date, 98) as r2(date,count)
  UNION ALL
  SELECT date, count FROM (SELECT '2019-09-04'::date, 451) as r4(date, count)
  UNION ALL
  SELECT date, count FROM (SELECT '2019-09-05'::date, 239) as r5(date, count)
  UNION ALL
  SELECT date, count FROM (SELECT '2019-09-06'::date, 75) as r6(date, count)
  UNION ALL
  SELECT date, count FROM (SELECT '2019-09-07'::date, 306) as r7(date, count)
)
SELECT
TO_CHAR(dates.date, 'MM/DD/YYYY') as date,
COALESCE(logins.count,0) as count
FROM
dates
LEFT OUTER JOIN
logins
ON dates.date = logins.date
WHERE
dates.date &gt;= '2019-09-01' and dates.date &lt;= '2019-09-07'
ORDER BY dates.date
</code></pre>

<p>Let&rsquo;s break down what&rsquo;s going on from top to bottom:</p>

<p>The <code>WITH</code> clause is a Common Table Expression (CTE), that is basically a reusable piece of SQL that gets executed before your main <code>SELECT</code>. <a href="(/2018/02/06/3-ways-to-level-up-your-sql-as-a-software-engineer/)">I like it for readability</a>, especially compared to nested subqueries.</p>

<p>Inside the CTE, we&rsquo;re generating our date range, which we will uses as the left side of our <code>LEFT OUTER JOIN</code>. This is the key to having all possible dates represented in our final result.</p>

<p>We are generating dates by subtracting an integer from the hardcoded date at the end of the range we want: <code>'2019-09-10'::date - ROW_NUMBER() OVER() as date</code>. Hardcoding in this case is mostly to make the example easier to read.</p>

<p>The integer we are subtracting comes from the <code>ROW_NUMBER</code> window function. It&rsquo;s important to convince yourself that the pieces of your complicated SQL queries are actually doing what you think they are doing, so try it out:</p>

<pre><code>SELECT
  ROW_NUMBER() OVER()
FROM 
  some_big_enough_table
LIMIT 10;

</code></pre>

<p>Should give you back this:</p>

<pre><code> row_number 
------------
          1
          2
          3
          4
          5
          6
          7
          8
          9
         10
(10 rows)
</code></pre>

<p><code>some_big_enough_table</code> is any table in your database that has enough rows to generate the date range you want in the query. <code>ROW_NUMBER</code> is just counting the rows for you. It&rsquo;s a hack to get a series of numbers in play. In Redshift, where &ldquo;set returning functions&rdquo; aren&rsquo;t supported, we use this any time we need a large ordered set of integers to work with.</p>

<p>In this case, we can combine the integers with a hardcoded date, do a little date math, and get the range we want:</p>

<pre><code>        date         
---------------------
 2019-09-09 00:00:00
 2019-09-08 00:00:00
 2019-09-07 00:00:00
 2019-09-06 00:00:00
 2019-09-05 00:00:00
 2019-09-04 00:00:00
 2019-09-03 00:00:00
 2019-09-02 00:00:00
 2019-09-01 00:00:00
 2019-08-31 00:00:00
 2019-08-30 00:00:00
 2019-08-29 00:00:00
 2019-08-28 00:00:00
 2019-08-27 00:00:00
(14 rows)
</code></pre>

<p>Now that we have a complete date range, we can join on it as a reference table. With the <code>LEFT OUTER JOIN</code>, we&rsquo;re taking everything from the date range table, and knitting in the rows from our metrics table by joining on date.</p>

<p><code>COALESCE</code>, another one of my favorite functions, is doing the work of filling in the missing zero:</p>

<pre><code>    date    | count 
------------+-------
 09/01/2019 |   115
 09/02/2019 |    98
 09/03/2019 |     0
 09/04/2019 |   451
 09/05/2019 |   239
 09/06/2019 |    75
 09/07/2019 |   306
(7 rows)
</code></pre>

<p>Without the <code>COALESCE(logins.count,0) as count</code>, we would still have all our dates, but in the second column we would have a <code>NULL</code> value for 9/3/2019:</p>

<pre><code>    date    | count 
------------+-------
 09/01/2019 |   115
 09/02/2019 |    98
 09/03/2019 |      
 09/04/2019 |   451
 09/05/2019 |   239
 09/06/2019 |    75
 09/07/2019 |   306
(7 rows)
</code></pre>

<p><code>COALESCE</code> basically says, &ldquo;give me <code>logins.count</code> but if you don&rsquo;t have it, I&rsquo;ll take a <code>0</code>&rdquo;.</p>

<p>Most importantly, we now can build a chart that has one entry per day, whether or not there is a corresponding metric value:</p>

<p><img src="/img/full_graph.png" alt="No Missing Dates in Report"></p>

<p>Again, the specific functions and implementations are going to vary depending on the type of database system you&rsquo;re using, but hopefully the underlying SQL concept is clear and you have some strategies for generating baseline structure and data for your SQL reporting.</p>
  </div>

  <footer>
    <ul class="stats">
    
        

        
        
            <li>
                
                
                    

                    

                    
                        <i class="fa fa-sitemap">&nbsp;</i>
                    

                    
                        Categories
                    
                
            </li>
        
    

    
    
        <li><a href='/categories/code'>Code</a></li>
    
        <li><a href='/categories/sql'>SQL</a></li>
    
        <li><a href='/categories/quick-tip'>Quick Tip</a></li>
    
</ul>

  </footer>

</article>


<ul class="actions pagination">
    
        <li><a href="https://dankleiman.com/2019/08/30/sql-quick-tip-present-cleaner-results-with-custom-ordering"
                class="button big previous">SQL Quick Tip: Present Cleaner Results with Custom Ordering</a></li>
    

    
        <li><a href="https://dankleiman.com/2019/09/27/sql-quick-tip-showing-changes-in-your-data"
                class="button big next">SQL Quick Tip: Showing Changes in Your Data</a></li>
    
</ul>


    </div>
    
<section id="sidebar">

  
  <section id="intro">
    
    
      
        <a href='/'><img src="/img/main/headshot.jpg" class="intro-circle" width="150" alt="Dan Kleiman" /></a>
      
    
    
      <header>
        <h2>Dan Kleiman</h2>
        <p>Posts about code and work and some tai chi archives too</p>
      </header>
    
    
      <ul class="icons">
        
          <li>
            <a href="" type="application/rss+xml" target="_blank" title="RSS" class="fa fa-rss"></a>
          </li>
        
        
  <li><a href="//github.com/dankleiman" target="_blank" title="GitHub" class="fa fa-github"></a></li>

























  <li><a href="//linkedin.com/in/dlkleiman" target="_blank" title="LinkedIn" class="fa fa-linkedin"></a></li>













  <li><a href="//reddit.com/user/upalready" target="_blank" title="Reddit" class="fa fa-reddit"></a></li>





















  <li><a href="//twitter.com/Dan_Kleiman" target="_blank" title="Twitter" class="fa fa-twitter"></a></li>













  <li><a href="mailto:info@dankleiman.com" title="Email" class="fa fa-envelope"></a></li>


      </ul>
    
  </section>

  
  
    <section id="mini-bio">
        <div id='mc_embed_signup'><form action='https://dankleiman.us1.list-manage.com/subscribe/post?u=0e4a1aa488d23c693881caeec&amp;id=99d1412a0b' method='post' id='mc-embedded-subscribe-form' name='mc-embedded-subscribe-form' class='validate' target='_blank' novalidate><div id='mc_embed_signup_scroll'><h2>Stay up to date via email</h2><div class='mc-field-group'><label for='mce-EMAIL'>Your Email Address</label><input type='email' value='' name='EMAIL' class='required email' id='mce-EMAIL'></div><div id='mce-responses' class='clear'><div class='response' id='mce-error-response' style='display:none'></div><div class='response' id='mce-success-response' style='display:none'></div></div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups--><div style='position: absolute; left: -5000px;' aria-hidden='true'><input type='text' name='b_0e4a1aa488d23c693881caeec_99d1412a0b' tabindex='-1' value=''></div><div class='clear'><input type='submit' value='Subscribe' name='subscribe' id='mc-embedded-subscribe' class='button'></div></div></form></div>
    </section>
  

  
  <section id="recent-posts">
    <div class="mini-posts">
      <header>
        <h3>Recent Posts</h3>
      </header>
      <div class="posts-container">
        

        
          
        

        
          <article class="mini-post">
            <header>
              <h3>
                <a href="https://dankleiman.com/2019/10/12/sql-quick-tip-find-the-latest-record-for-each-member-of-a-group">SQL Quick Tip: Find the Latest Record for Each Member of a Group</a>
              </h3>
              
              <time class="published" datetime='2019-10-12'>
                October 12, 2019
              </time>
            </header>
            

          </article>
        
          <article class="mini-post">
            <header>
              <h3>
                <a href="https://dankleiman.com/2019/10/06/sql-quick-tip-find-missing-data">SQL Quick Tip: Find Missing Data</a>
              </h3>
              
              <time class="published" datetime='2019-10-06'>
                October 6, 2019
              </time>
            </header>
            

          </article>
        
          <article class="mini-post">
            <header>
              <h3>
                <a href="https://dankleiman.com/2019/09/27/sql-quick-tip-showing-changes-in-your-data">SQL Quick Tip: Showing Changes in Your Data</a>
              </h3>
              
              <time class="published" datetime='2019-09-27'>
                September 27, 2019
              </time>
            </header>
            

          </article>
        
          <article class="mini-post">
            <header>
              <h3>
                <a href="https://dankleiman.com/2019/09/12/sql-quick-tip-guarantee-rows-for-every-date-in-your-report">SQL Quick Tip: Guarantee Rows for Every Date in Your Report</a>
              </h3>
              
              <time class="published" datetime='2019-09-12'>
                September 12, 2019
              </time>
            </header>
            

          </article>
        
          <article class="mini-post">
            <header>
              <h3>
                <a href="https://dankleiman.com/2019/08/30/sql-quick-tip-present-cleaner-results-with-custom-ordering">SQL Quick Tip: Present Cleaner Results with Custom Ordering</a>
              </h3>
              
              <time class="published" datetime='2019-08-30'>
                August 30, 2019
              </time>
            </header>
            

          </article>
        
      </div>

      
        <a href=
          
            /post/
          
        class="button">View more posts</a>
      
    </div>
  </section>

  
  
  
  
    <section id="categories">
      <header>
        <h3>
          <a href="/categories/">Categories</a>
        </h3>
      </header>
        
          
        

        
        <p>
          <article>
            <header>
              
                <a href="/categories/tai-chi/">Tai Chi</a>
                <span style="float:right;">85</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/qigong/">Qigong</a>
                <span style="float:right;">74</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/code/">Code</a>
                <span style="float:right;">38</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/movement-practice/">Movement Practice</a>
                <span style="float:right;">33</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/small-business/">Small Business</a>
                <span style="float:right;">21</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/inner-form/">Inner Form</a>
                <span style="float:right;">14</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/practice-people/">Practice People</a>
                <span style="float:right;">12</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/practice-tip/">Practice Tip</a>
                <span style="float:right;">10</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/launch-academy/">Launch Academy</a>
                <span style="float:right;">9</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/psychology/">Psychology</a>
                <span style="float:right;">9</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/sql/">SQL</a>
                <span style="float:right;">9</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/btc/">BTC</a>
                <span style="float:right;">5</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/events/">Events</a>
                <span style="float:right;">5</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/quick-tip/">Quick Tip</a>
                <span style="float:right;">5</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/site/">Site</a>
                <span style="float:right;">5</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/trainerfly/">Trainerfly</a>
                <span style="float:right;">5</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/bigquery/">BigQuery</a>
                <span style="float:right;">3</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/energy-arts/">Energy Arts</a>
                <span style="float:right;">3</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/twilio/">Twilio</a>
                <span style="float:right;">3</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/golang/">Golang</a>
                <span style="float:right;">2</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/octopress/">Octopress</a>
                <span style="float:right;">2</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/rails/">Rails</a>
                <span style="float:right;">2</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/ruby/">Ruby</a>
                <span style="float:right;">2</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/static-sites/">Static Sites</a>
                <span style="float:right;">2</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/courses-and-events/">Courses and Events</a>
                <span style="float:right;">1</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/learning/">Learning</a>
                <span style="float:right;">1</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/meditation/">Meditation</a>
                <span style="float:right;">1</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/railsconf/">RailsConf</a>
                <span style="float:right;">1</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/security/">Security</a>
                <span style="float:right;">1</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/sinatra/">Sinatra</a>
                <span style="float:right;">1</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/xing-yi/">Xing Yi</a>
                <span style="float:right;">1</span>
              
            </header>
          </article>
        </p>
        
    </section>
  

  
  

  
  <section id="footer">
    
      <ul class="icons">
        
          <li>
            <a href="" type="application/rss+xml" target="_blank" title="RSS" class="fa fa-rss"></a>
          </li>
        
        
  <li><a href="//github.com/dankleiman" target="_blank" title="GitHub" class="fa fa-github"></a></li>

























  <li><a href="//linkedin.com/in/dlkleiman" target="_blank" title="LinkedIn" class="fa fa-linkedin"></a></li>













  <li><a href="//reddit.com/user/upalready" target="_blank" title="Reddit" class="fa fa-reddit"></a></li>





















  <li><a href="//twitter.com/Dan_Kleiman" target="_blank" title="Twitter" class="fa fa-twitter"></a></li>













  <li><a href="mailto:info@dankleiman.com" title="Email" class="fa fa-envelope"></a></li>


      </ul>
    
    <p class="copyright">
      
        &copy; 2019
        
          Dan Kleiman
        
      .
      Powered by <a href="//gohugo.io" target="_blank">Hugo</a>
    </p>
  </section>
</section>

    </div>
    <a id="back-to-top" href="#" class="fa fa-arrow-up fa-border fa-2x"></a>
    

    
      
    

    
    
      <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/skel/3.0.1/skel.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.25/jquery.fancybox.min.js"></script>
      <script src="https://dankleiman.com/js/util.js"></script>
      <script src="https://dankleiman.com/js/main.js"></script>
      <script src="https://dankleiman.com/js/backToTop.js"></script>
    

    
      
        
      
    

    
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

