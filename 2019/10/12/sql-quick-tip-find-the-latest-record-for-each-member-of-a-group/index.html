<!DOCTYPE HTML>

<html>
    <head>
        
            
                <title>SQL Quick Tip: Find the Latest Record for Each Member of a Group</title>
            
        

        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="generator" content="Hugo 0.19-DEV" />
        


        
        
            
                <meta name="description" content="Tai Chi, Code, and Whatever from Dan Kleiman">
            
        

        

  <meta name="twitter:card" content="summary"/>



<meta name="twitter:title" content="SQL Quick Tip: Find the Latest Record for Each Member of a Group"/>
<meta name="twitter:description" content="In this post, we&rsquo;re going to look at a techinque for finding the lastest full record for each member of a group.
Now, it might not be obvious why this is an annoying problem, but I see people back into having this problem from two different directions.
First, you know how to find the MAX date for each member in a group:
 metric | latest_metric --------&#43;------------------------ A | 2019-04-30 00:00:00-04 B | 2019-05-08 00:00:00-04 C | 2019-05-08 00:00:00-04 D | 2019-05-08 00:00:00-04 E | 2019-05-08 00:00:00-04 F | 2019-05-08 00:00:00-04 (6 rows)  But you need additional column data from the same row as that most recent date."/>
<meta name="twitter:site" content="@Dan_Kleiman"/>


        <meta property="og:title" content="SQL Quick Tip: Find the Latest Record for Each Member of a Group" />
<meta property="og:description" content="In this post, we&rsquo;re going to look at a techinque for finding the lastest full record for each member of a group.
Now, it might not be obvious why this is an annoying problem, but I see people back into having this problem from two different directions.
First, you know how to find the MAX date for each member in a group:
 metric | latest_metric --------&#43;------------------------ A | 2019-04-30 00:00:00-04 B | 2019-05-08 00:00:00-04 C | 2019-05-08 00:00:00-04 D | 2019-05-08 00:00:00-04 E | 2019-05-08 00:00:00-04 F | 2019-05-08 00:00:00-04 (6 rows)  But you need additional column data from the same row as that most recent date." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://dankleiman.com/2019/10/12/sql-quick-tip-find-the-latest-record-for-each-member-of-a-group" />



<meta property="article:published_time" content="2019-10-12T07:30:37-04:00"/>
<meta property="article:modified_time" content="2019-10-12T07:30:37-04:00"/>











        
<meta itemprop="name" content="SQL Quick Tip: Find the Latest Record for Each Member of a Group">
<meta itemprop="description" content="In this post, we&rsquo;re going to look at a techinque for finding the lastest full record for each member of a group.
Now, it might not be obvious why this is an annoying problem, but I see people back into having this problem from two different directions.
First, you know how to find the MAX date for each member in a group:
 metric | latest_metric --------&#43;------------------------ A | 2019-04-30 00:00:00-04 B | 2019-05-08 00:00:00-04 C | 2019-05-08 00:00:00-04 D | 2019-05-08 00:00:00-04 E | 2019-05-08 00:00:00-04 F | 2019-05-08 00:00:00-04 (6 rows)  But you need additional column data from the same row as that most recent date.">


<meta itemprop="dateModified" content="2019-10-12T07:30:37-04:00" />
<meta itemprop="wordCount" content="1049">



<meta itemprop="keywords" content="BTC,BigQuery,Code,Courses and Events,Energy Arts,Events,Golang,Inner Form,Launch Academy,Learning,Meditation,Movement Practice,Octopress,Practice People,Practice Tip,Psychology,Qigong,Quick Tip,Rails,RailsConf,Ruby,SQL,Security,Sinatra,Site,Small Business,Static Sites,Tai Chi,Trainerfly,Twilio,Xing Yi,1000 True Fans,5 Elements,An,BC,BJ Fogg,Ba Gua,Balance,Behavior Change,Bend the Bow,Bill Ryan,Breathing,Breathing Exercise,Breathing For Relaxation,Brookline Tai Chi,Bruce Frantzis,Bruce Lee,Business Tools,Cathy Kerr,Central Equilibrium,Cheng Man Ching,Chi,Chicago Tai Chi,Chinese Medicine,Cloud Hands,Conflict Resolution,Creativity,Crossfit,DPH,Daily Practice,David-Dorian Ross,Deliberate Practice,Design,Diaphragmatic Breathing,Don Ethan Miller,Dorothy Fitzer,Dr. Mark Cheng,Dragon and Tiger,Elephant Wrestling,Energies,Energy,Energy Arts,Energy Gates Dissolving Series,Enterprise of One,Entrepreneurship,Exercise Mp3,Eyes,Fall Prevention,Favorite Quotes,Feedback,Feng Zhiqiang,Five Movement Centers,Foundations of Relaxation,Fuzhong Li,Gaming,Gods Playing in the Clouds,Harvard Medical School,Harvard Medical School Guide,Health Month,Heath Brothers,Heaven and Earth,Hot Triggers,Immersion,Inc. Magazine,Inner Form,Inner Game of Tennis,Instructor Training,Intrinsic Motivation,Intuition,Isaac Kamins,Jane McGonigal,Ji,Josh Kaufman,Learning Tai Chi,Lee Scheele,Leverage,Lu,Marriage of Heaven and Earth,Master Wang Hao Da,Medicine,Meditate,Meditation,Meditation Practice,Mobile,Mobility,Moodle,Motivation,Myth of the Overworked Creative,Online Learning,Opening and Closing,Pain,Paul Cavel,Peng,Perfect Practice,Personal MBA,Personal Practice,Peter Wayne,Posture,Product Launch,Productivity,Pulsing,Push Hands,Qi,Qigong,Qigong Breathing,Qigong Practice,Qigong Radio,Qigong Youtube,Quantity,Ramit Sethi,Rhythm,Robert Tangora,Running a school,San Ti,Seasonal Practice,Sitting Practice,Spinal Qigong,Spiraling Energy Body,Spiritual Practice,Standing Qigong,Standing Series,Stanford,State of the Art,Stretch,Swing,Swings,Switch,Systems,T&#39;ai Chi Ch&#39;uan,T&#39;ai Chi for Health and Happiness,TED talks,Tai Chi,Tai Chi Classics,Tai Chi Equipment Training,Tai Chi Mastery Program,Tai Chi Postures,Tai Chi Practice,Tai Chi Principles,Tai Chi Research,Tai Chi Teacher,Taoist Arts,TechCrunch,Technology,The Tools,Tony Schwartz,Traditional Chinese Medicine,Trainerfly Backstory,Travel,Vancouver,Vision,Visual Training,Week,Wordpress,Wu Jianquan,Wu Short Form Instructor Training 2011,Yoga,Your Practice,Z Health,alignments,anxiety,case study,chi gung,depression,dissolving,energy gates,energy management,fear,feet,flexibility,four points,joint mobility,kwa,learning,mind,neigong,practice,practice tips,problem solving,relaxation,rooting,seminars,sinking,small business marketing,song,spine,standing,stress,teaching,twisting,xingyi,yin and yang,zhong ding," />

        

        
            
        

        
        
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css">
            <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway:400,800,900|Source+Sans+Pro:400,700">
            <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.25/jquery.fancybox.min.css">
            <link rel="stylesheet" href="https://dankleiman.com/css/main.css">
            <link rel="stylesheet" href="https://dankleiman.com/css/add-on.css">
        

        
            
                
            
        

        
            
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-19970008-2', 'auto');
ga('send', 'pageview');
</script>

        
    </head>
    <body>

      
      <div id="wrapper">

    
    
<header id="header">
    
      <h1><a href="https://dankleiman.com/">post</a></h1>
    

    <nav class="links">
        <ul>
            
                <li>
                    <a href="/">
                            <i class="fa fa-home">&nbsp;</i>Home
                    </a>
                </li>
            
                <li>
                    <a href="/about/">
                            <i class="fa fa-id-card-o">&nbsp;</i>About
                    </a>
                </li>
            
                <li>
                    <a href="/post/">
                            <i class="fa fa-newspaper-o">&nbsp;</i>Blog
                    </a>
                </li>
            
                <li>
                    <a href="/categories/">
                            <i class="fa fa-sitemap">&nbsp;</i>Categories
                    </a>
                </li>
            
        </ul>
    </nav>
    <nav class="main">
        <ul>
            
            <li id="share-nav" class="share-menu" style="display:none;">
                <a class="fa-share-alt" href="#share-menu">Share</a>
            </li>
            
            <li class="search">
                <a class="fa-search" href="#search">Search</a>
                <form id="search" method="get" action="//google.com/search">
                    <input type="text" name="q" placeholder="Search" />
                    <input type="hidden" name="as_sitesearch" value="https://dankleiman.com/">
                </form>
            </li>
            <li class="menu">
                <a class="fa-bars" href="#menu">Menu</a>
            </li>
        </ul>
    </nav>
</header>


<section id="menu">

    
        <section>
            <form class="search" method="get" action="//google.com/search">
                <input type="text" name="q" placeholder="Search" />
                <input type="hidden" name="as_sitesearch" value="https://dankleiman.com/">
            </form>
        </section>

    
        <section>
            <ul class="links">
                
                    <li>
                        <a href="/">
                            <h3>
                                <i class="fa fa-home">&nbsp;</i>Home
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="/about/">
                            <h3>
                                <i class="fa fa-id-card-o">&nbsp;</i>About
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="/post/">
                            <h3>
                                <i class="fa fa-newspaper-o">&nbsp;</i>Blog
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="/categories/">
                            <h3>
                                <i class="fa fa-sitemap">&nbsp;</i>Categories
                            </h3>
                        </a>
                    </li>
                
            </ul>
        </section>

    
        <section id="recent-posts">
            <div class="mini-posts">
                <header>
                    <h3>Recent Posts</h3>
                </header>
                

                
                    
                

                
                        <article class="mini-post">
                            <header>
                                <h3><a href="https://dankleiman.com/2019/10/12/sql-quick-tip-find-the-latest-record-for-each-member-of-a-group">SQL Quick Tip: Find the Latest Record for Each Member of a Group</a></h3>
                                
                                <time class="published" datetime=
                                    '2019-10-12'>
                                    October 12, 2019</time>
                            </header>
                            

                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="https://dankleiman.com/2019/10/06/sql-quick-tip-find-missing-data">SQL Quick Tip: Find Missing Data</a></h3>
                                
                                <time class="published" datetime=
                                    '2019-10-06'>
                                    October 6, 2019</time>
                            </header>
                            

                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="https://dankleiman.com/2019/09/27/sql-quick-tip-showing-changes-in-your-data">SQL Quick Tip: Showing Changes in Your Data</a></h3>
                                
                                <time class="published" datetime=
                                    '2019-09-27'>
                                    September 27, 2019</time>
                            </header>
                            

                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="https://dankleiman.com/2019/09/12/sql-quick-tip-guarantee-rows-for-every-date-in-your-report">SQL Quick Tip: Guarantee Rows for Every Date in Your Report</a></h3>
                                
                                <time class="published" datetime=
                                    '2019-09-12'>
                                    September 12, 2019</time>
                            </header>
                            

                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="https://dankleiman.com/2019/08/30/sql-quick-tip-present-cleaner-results-with-custom-ordering">SQL Quick Tip: Present Cleaner Results with Custom Ordering</a></h3>
                                
                                <time class="published" datetime=
                                    '2019-08-30'>
                                    August 30, 2019</time>
                            </header>
                            

                        </article>
                

                
                    <a href=
                        
                            /post/
                        
                        class="button">View more posts</a>
                
            </div>
        </section>

    
        
</section>

    <section id="share-menu">
    <section id="social-share-nav">
        <ul class="links">
            <header>
                <h3>Share this post <i class="fa fa-smile-o"></i></h3>
            </header>
            


<li>
  <a href="//twitter.com/share?url=https%3a%2f%2fdankleiman.com%2f2019%2f10%2f12%2fsql-quick-tip-find-the-latest-record-for-each-member-of-a-group&text=SQL%20Quick%20Tip%3a%20Find%20the%20Latest%20Record%20for%20Each%20Member%20of%20a%20Group&via=Dan_Kleiman" target="_blank" class="share-btn twitter">
    <i class="fa fa-twitter"></i>
    <p>Twitter</p>
    </a>
</li>


<li>
  <a href="//plus.google.com/share?url=https%3a%2f%2fdankleiman.com%2f2019%2f10%2f12%2fsql-quick-tip-find-the-latest-record-for-each-member-of-a-group" target="_blank" class="share-btn google-plus">
    <i class="fa fa-google-plus"></i>
    <p>Google+</p>
  </a>
</li>


<li>
  <a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fdankleiman.com%2f2019%2f10%2f12%2fsql-quick-tip-find-the-latest-record-for-each-member-of-a-group" target="_blank" class="share-btn facebook">
    <i class="fa fa-facebook"></i>
    <p>Facebook</p>
    </a>
</li>


<li>
  <a href="//reddit.com/submit?url=https%3a%2f%2fdankleiman.com%2f2019%2f10%2f12%2fsql-quick-tip-find-the-latest-record-for-each-member-of-a-group&title=SQL%20Quick%20Tip%3a%20Find%20the%20Latest%20Record%20for%20Each%20Member%20of%20a%20Group" target="_blank" class="share-btn reddit">
    <i class="fa fa-reddit-alien"></i>
    <p>Reddit</p>
  </a>
</li>


<li>
  <a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fdankleiman.com%2f2019%2f10%2f12%2fsql-quick-tip-find-the-latest-record-for-each-member-of-a-group&title=SQL%20Quick%20Tip%3a%20Find%20the%20Latest%20Record%20for%20Each%20Member%20of%20a%20Group" target="_blank" class="share-btn linkedin">
      <i class="fa fa-linkedin"></i>
      <p>LinkedIn</p>
    </a>
</li>


<li>
  <a href="//www.stumbleupon.com/submit?url=https%3a%2f%2fdankleiman.com%2f2019%2f10%2f12%2fsql-quick-tip-find-the-latest-record-for-each-member-of-a-group&title=SQL%20Quick%20Tip%3a%20Find%20the%20Latest%20Record%20for%20Each%20Member%20of%20a%20Group" target="_blank" class="share-btn stumbleupon">
    <i class="fa fa-stumbleupon"></i>
    <p>StumbleUpon</p>
  </a>
</li>


<li>
  <a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fdankleiman.com%2f2019%2f10%2f12%2fsql-quick-tip-find-the-latest-record-for-each-member-of-a-group&description=SQL%20Quick%20Tip%3a%20Find%20the%20Latest%20Record%20for%20Each%20Member%20of%20a%20Group" target="_blank" class="share-btn pinterest">
    <i class="fa fa-pinterest-p"></i>
    <p>Pinterest</p>
  </a>
</li>


<li>
  <a href="mailto:?subject=Check out this post by &body=https%3a%2f%2fdankleiman.com%2f2019%2f10%2f12%2fsql-quick-tip-find-the-latest-record-for-each-member-of-a-group" target="_blank" class="share-btn email">
    <i class="fa fa-envelope"></i>
    <p>Email</p>
  </a>
</li>

        </ul>
    </section>
</section>

    
    <div id="main">
        
        
        <article class="post">
  <header>
    <div class="title">
        
            <h1><a href="https://dankleiman.com/2019/10/12/sql-quick-tip-find-the-latest-record-for-each-member-of-a-group">SQL Quick Tip: Find the Latest Record for Each Member of a Group</a></h1>
            
        
        
    </div>
    <div class="meta">
        

        <time class="published"
            datetime='2019-10-12'>
            October 12, 2019</time>
        <span class="author"></span>
        
            <p>5 minute read</p>
        
        
    </div>
</header>


  
    <section id="social-share">
      <ul class="icons">
        


<li>
  <a href="//twitter.com/share?url=https%3a%2f%2fdankleiman.com%2f2019%2f10%2f12%2fsql-quick-tip-find-the-latest-record-for-each-member-of-a-group&text=SQL%20Quick%20Tip%3a%20Find%20the%20Latest%20Record%20for%20Each%20Member%20of%20a%20Group&via=Dan_Kleiman" target="_blank" class="share-btn twitter">
    <i class="fa fa-twitter"></i>
    <p>Twitter</p>
    </a>
</li>


<li>
  <a href="//plus.google.com/share?url=https%3a%2f%2fdankleiman.com%2f2019%2f10%2f12%2fsql-quick-tip-find-the-latest-record-for-each-member-of-a-group" target="_blank" class="share-btn google-plus">
    <i class="fa fa-google-plus"></i>
    <p>Google+</p>
  </a>
</li>


<li>
  <a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fdankleiman.com%2f2019%2f10%2f12%2fsql-quick-tip-find-the-latest-record-for-each-member-of-a-group" target="_blank" class="share-btn facebook">
    <i class="fa fa-facebook"></i>
    <p>Facebook</p>
    </a>
</li>


<li>
  <a href="//reddit.com/submit?url=https%3a%2f%2fdankleiman.com%2f2019%2f10%2f12%2fsql-quick-tip-find-the-latest-record-for-each-member-of-a-group&title=SQL%20Quick%20Tip%3a%20Find%20the%20Latest%20Record%20for%20Each%20Member%20of%20a%20Group" target="_blank" class="share-btn reddit">
    <i class="fa fa-reddit-alien"></i>
    <p>Reddit</p>
  </a>
</li>


<li>
  <a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fdankleiman.com%2f2019%2f10%2f12%2fsql-quick-tip-find-the-latest-record-for-each-member-of-a-group&title=SQL%20Quick%20Tip%3a%20Find%20the%20Latest%20Record%20for%20Each%20Member%20of%20a%20Group" target="_blank" class="share-btn linkedin">
      <i class="fa fa-linkedin"></i>
      <p>LinkedIn</p>
    </a>
</li>


<li>
  <a href="//www.stumbleupon.com/submit?url=https%3a%2f%2fdankleiman.com%2f2019%2f10%2f12%2fsql-quick-tip-find-the-latest-record-for-each-member-of-a-group&title=SQL%20Quick%20Tip%3a%20Find%20the%20Latest%20Record%20for%20Each%20Member%20of%20a%20Group" target="_blank" class="share-btn stumbleupon">
    <i class="fa fa-stumbleupon"></i>
    <p>StumbleUpon</p>
  </a>
</li>


<li>
  <a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fdankleiman.com%2f2019%2f10%2f12%2fsql-quick-tip-find-the-latest-record-for-each-member-of-a-group&description=SQL%20Quick%20Tip%3a%20Find%20the%20Latest%20Record%20for%20Each%20Member%20of%20a%20Group" target="_blank" class="share-btn pinterest">
    <i class="fa fa-pinterest-p"></i>
    <p>Pinterest</p>
  </a>
</li>


<li>
  <a href="mailto:?subject=Check out this post by &body=https%3a%2f%2fdankleiman.com%2f2019%2f10%2f12%2fsql-quick-tip-find-the-latest-record-for-each-member-of-a-group" target="_blank" class="share-btn email">
    <i class="fa fa-envelope"></i>
    <p>Email</p>
  </a>
</li>

      </ul>
    </section>
  

  

  <div id="content">
    

<p>In this post, we&rsquo;re going to look at a techinque for finding the lastest full record for each member of a group.</p>

<p>Now, it might not be obvious why this is an annoying problem, but I see people back into having this problem from two different directions.</p>

<p>First, you know how to find the <code>MAX</code> date for each member in a group:</p>

<pre><code>
 metric |     latest_metric      
--------+------------------------
 A      | 2019-04-30 00:00:00-04
 B      | 2019-05-08 00:00:00-04
 C      | 2019-05-08 00:00:00-04
 D      | 2019-05-08 00:00:00-04
 E      | 2019-05-08 00:00:00-04
 F      | 2019-05-08 00:00:00-04
(6 rows)

</code></pre>

<p>But you need additional column data from the same row as that most recent date.</p>

<p>Or&hellip;</p>

<p>You found the whole record for one member in the set:</p>

<pre><code>
 metric |          date          | value 
--------+------------------------+-------
 A      | 2019-04-30 00:00:00-04 |   889
(1 row)

</code></pre>

<p>But you need to do the same thing for all the metrics too.</p>

<p>To solve this kind of problem, we can use the <code>ROW_NUMBER</code> function to sort our data and reference it as a sorted sub-sets.</p>

<p>Let&rsquo;s break down the pieces that get us to a <code>ROW_NUMBER</code> solution.</p>

<!-- more -->

<p>Here is our metrics table:</p>

<pre><code>                       Table &quot;public.metrics&quot;
 Column |           Type           | Collation | Nullable | Default 
--------+--------------------------+-----------+----------+---------
 date   | timestamp with time zone |           |          | 
 metric | text                     |           |          | 
 value  | double precision         |           |          | 

</code></pre>

<p>Start by finding the most recent date for each metric:</p>

<pre><code>
SELECT
  metric,
  max(date) as latest_metric
FROM
  metrics
GROUP BY 1
ORDER BY 1;

 metric |     latest_metric      
--------+------------------------
 A      | 2019-04-30 00:00:00-04
 B      | 2019-05-08 00:00:00-04
 C      | 2019-05-08 00:00:00-04
 D      | 2019-05-08 00:00:00-04
 E      | 2019-05-08 00:00:00-04
 F      | 2019-05-08 00:00:00-04
(6 rows)

</code></pre>

<p>Again, this gets us the latest date for each metric, but we don&rsquo;t really have access to the <em>row</em> this data is from. That&rsquo;s what we need if we want to pull additional column values.</p>

<p>If you only have to answer the question for a single metric, it&rsquo;s easy:</p>

<pre><code>
SELECT
  metric,
  date,
  value
FROM
  metrics
WHERE metric = 'A'
ORDER BY date DESC
LIMIT 1;

 metric |          date          | value 
--------+------------------------+-------
 A      | 2019-04-30 00:00:00-04 |   889
(1 row)

</code></pre>

<p>If this is code that lives inside an application that is just looking up the latest data for a specific metric, you&rsquo;re fine with the <code>ORDER BY</code> and <code>LIMIT</code> solution. But any time you need to jump from a solution that works for one member of the group to all members of the group, you need a <strong>window-based solution</strong> to do it in a single query.</p>

<h2 id="finding-records-not-just-values">Finding Records,  Not Just Values</h2>

<p>In SQL, window functions allow you to perform operations over subsets of rows by defining a window on the rows. <code>ROW_NUMBER</code> is a special window function that will number the rows inside your window.</p>

<p>So, if we take all the metric &lsquo;A&rsquo; rows and add a <code>ROW_NUMBER</code> column:</p>

<pre><code>
SELECT
  metric,
  date,
  value,
  ROW_NUMBER() OVER(PARTITION BY metric ORDER BY date DESC) AS rn
FROM
  metrics
WHERE metric = 'A'
ORDER BY date DESC;

</code></pre>

<p>The numbered rows look like this:</p>

<pre><code>
 metric |          date          | value | rn 
--------+------------------------+-------+----
 A      | 2019-04-30 00:00:00-04 |   889 |  1
 A      | 2019-04-13 00:00:00-04 |   156 |  2
 A      | 2019-04-10 00:00:00-04 |   274 |  3
 A      | 2019-04-02 00:00:00-04 |   812 |  4
 A      | 2019-03-31 00:00:00-04 |   904 |  5
 A      | 2019-03-29 00:00:00-04 |   611 |  6
 A      | 2019-03-27 00:00:00-04 |   761 |  7
 A      | 2019-03-23 00:00:00-04 |   209 |  8
 A      | 2019-03-06 00:00:00-05 |   231 |  9
 A      | 2019-03-04 00:00:00-05 |    82 | 10
 A      | 2019-02-27 00:00:00-05 |   138 | 11
 A      | 2019-02-25 00:00:00-05 |   537 | 12
 A      | 2019-02-19 00:00:00-05 |   228 | 13
 A      | 2019-02-12 00:00:00-05 |   581 | 14
 A      | 2019-02-11 00:00:00-05 |   657 | 15
 A      | 2019-02-10 00:00:00-05 |     9 | 16
 A      | 2019-02-05 00:00:00-05 |   965 | 17
 A      | 2019-02-04 00:00:00-05 |   826 | 18
 A      | 2019-01-31 00:00:00-05 |   878 | 19
 A      | 2019-01-28 00:00:00-05 |   729 | 20
 A      | 2019-01-26 00:00:00-05 |   168 | 21
 A      | 2019-01-22 00:00:00-05 |   797 | 22
 A      | 2019-01-18 00:00:00-05 |   618 | 23
(23 rows)

</code></pre>

<p>Without the <code>WHERE metric = 'A'</code> filter, you can see that the window function repeats the numbering for each metric:</p>

<pre><code>
 metric |          date          | value | rn 
--------+------------------------+-------+----
 A      | 2019-04-30 00:00:00-04 |   889 |  1
 A      | 2019-04-13 00:00:00-04 |   156 |  2
 A      | 2019-04-10 00:00:00-04 |   274 |  3
 B      | 2019-05-08 00:00:00-04 |   954 |  1
 B      | 2019-04-10 00:00:00-04 |   639 |  2
 B      | 2019-03-31 00:00:00-04 |   989 |  3
 C      | 2019-05-08 00:00:00-04 |   594 |  1
 C      | 2019-04-30 00:00:00-04 |    28 |  2
 C      | 2019-04-13 00:00:00-04 |    61 |  3
 D      | 2019-05-08 00:00:00-04 |   160 |  1
 D      | 2019-04-30 00:00:00-04 |   432 |  2
 D      | 2019-04-02 00:00:00-04 |   102 |  3
 E      | 2019-05-08 00:00:00-04 |    49 |  1
 E      | 2019-04-10 00:00:00-04 |   307 |  2
 E      | 2019-04-02 00:00:00-04 |   674 |  3
 F      | 2019-05-08 00:00:00-04 |   773 |  1
 F      | 2019-04-30 00:00:00-04 |   918 |  2
 F      | 2019-04-13 00:00:00-04 |   799 |  3
(18 rows)

</code></pre>

<p>The window definition in our <code>ROW_NUMBER</code> function has two critical parts:</p>

<ul>
<li><code>PARTITION BY</code> which defines the columns we want to group by</li>
<li><code>ORDER BY</code> which defines how the numbering will be applied to the windowed rows</li>
</ul>

<p>Because we defined our window as &ldquo;grouped by&rdquo; metric and &ldquo;ordered by&rdquo; date descending, the most recent date for each metric will always have a value of <code>1</code> in the row number column.</p>

<p>With the numbering in place, we can run the numbering query as a subquery and pull out <code>rn = 1</code> for the final results:</p>

<pre><code>
SELECT
  metric,
  date,
  value
FROM (
  SELECT
    metric,
    date,
    value,
    ROW_NUMBER() OVER(PARTITION BY metric ORDER BY date DESC) AS rn
  FROM
    metrics
) m
WHERE rn = 1;

</code></pre>

<p>Which leaves us with the full record for the most recent date of each metric:</p>

<pre><code>
 metric |          date          | value 
--------+------------------------+-------
 A      | 2019-04-30 00:00:00-04 |   889
 B      | 2019-05-08 00:00:00-04 |   954
 C      | 2019-05-08 00:00:00-04 |   594
 D      | 2019-05-08 00:00:00-04 |   160
 E      | 2019-05-08 00:00:00-04 |    49
 F      | 2019-05-08 00:00:00-04 |   773
(6 rows)

</code></pre>

  </div>

  <footer>
    <ul class="stats">
    
        

        
        
            <li>
                
                
                    

                    

                    
                        <i class="fa fa-sitemap">&nbsp;</i>
                    

                    
                        Categories
                    
                
            </li>
        
    

    
    
        <li><a href='/categories/code'>Code</a></li>
    
        <li><a href='/categories/sql'>SQL</a></li>
    
        <li><a href='/categories/quick-tip'>Quick Tip</a></li>
    
</ul>

  </footer>

</article>


<ul class="actions pagination">
    
        <li><a href="https://dankleiman.com/2019/10/06/sql-quick-tip-find-missing-data"
                class="button big previous">SQL Quick Tip: Find Missing Data</a></li>
    

    
</ul>


    </div>
    
<section id="sidebar">

  
  <section id="intro">
    
    
      
        <a href='/'><img src="/img/main/headshot.jpg" class="intro-circle" width="150" alt="Dan Kleiman" /></a>
      
    
    
      <header>
        <h2>Dan Kleiman</h2>
        <p>Posts about code and work and some tai chi archives too</p>
      </header>
    
    
      <ul class="icons">
        
          <li>
            <a href="" type="application/rss+xml" target="_blank" title="RSS" class="fa fa-rss"></a>
          </li>
        
        
  <li><a href="//github.com/dankleiman" target="_blank" title="GitHub" class="fa fa-github"></a></li>

























  <li><a href="//linkedin.com/in/dlkleiman" target="_blank" title="LinkedIn" class="fa fa-linkedin"></a></li>













  <li><a href="//reddit.com/user/upalready" target="_blank" title="Reddit" class="fa fa-reddit"></a></li>





















  <li><a href="//twitter.com/Dan_Kleiman" target="_blank" title="Twitter" class="fa fa-twitter"></a></li>













  <li><a href="mailto:info@dankleiman.com" title="Email" class="fa fa-envelope"></a></li>


      </ul>
    
  </section>

  
  
    <section id="mini-bio">
        <div id='mc_embed_signup'><form action='https://dankleiman.us1.list-manage.com/subscribe/post?u=0e4a1aa488d23c693881caeec&amp;id=99d1412a0b' method='post' id='mc-embedded-subscribe-form' name='mc-embedded-subscribe-form' class='validate' target='_blank' novalidate><div id='mc_embed_signup_scroll'><h2>Stay up to date via email</h2><div class='mc-field-group'><label for='mce-EMAIL'>Your Email Address</label><input type='email' value='' name='EMAIL' class='required email' id='mce-EMAIL'></div><div id='mce-responses' class='clear'><div class='response' id='mce-error-response' style='display:none'></div><div class='response' id='mce-success-response' style='display:none'></div></div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups--><div style='position: absolute; left: -5000px;' aria-hidden='true'><input type='text' name='b_0e4a1aa488d23c693881caeec_99d1412a0b' tabindex='-1' value=''></div><div class='clear'><input type='submit' value='Subscribe' name='subscribe' id='mc-embedded-subscribe' class='button'></div></div></form></div>
    </section>
  

  
  <section id="recent-posts">
    <div class="mini-posts">
      <header>
        <h3>Recent Posts</h3>
      </header>
      <div class="posts-container">
        

        
          
        

        
          <article class="mini-post">
            <header>
              <h3>
                <a href="https://dankleiman.com/2019/10/12/sql-quick-tip-find-the-latest-record-for-each-member-of-a-group">SQL Quick Tip: Find the Latest Record for Each Member of a Group</a>
              </h3>
              
              <time class="published" datetime='2019-10-12'>
                October 12, 2019
              </time>
            </header>
            

          </article>
        
          <article class="mini-post">
            <header>
              <h3>
                <a href="https://dankleiman.com/2019/10/06/sql-quick-tip-find-missing-data">SQL Quick Tip: Find Missing Data</a>
              </h3>
              
              <time class="published" datetime='2019-10-06'>
                October 6, 2019
              </time>
            </header>
            

          </article>
        
          <article class="mini-post">
            <header>
              <h3>
                <a href="https://dankleiman.com/2019/09/27/sql-quick-tip-showing-changes-in-your-data">SQL Quick Tip: Showing Changes in Your Data</a>
              </h3>
              
              <time class="published" datetime='2019-09-27'>
                September 27, 2019
              </time>
            </header>
            

          </article>
        
          <article class="mini-post">
            <header>
              <h3>
                <a href="https://dankleiman.com/2019/09/12/sql-quick-tip-guarantee-rows-for-every-date-in-your-report">SQL Quick Tip: Guarantee Rows for Every Date in Your Report</a>
              </h3>
              
              <time class="published" datetime='2019-09-12'>
                September 12, 2019
              </time>
            </header>
            

          </article>
        
          <article class="mini-post">
            <header>
              <h3>
                <a href="https://dankleiman.com/2019/08/30/sql-quick-tip-present-cleaner-results-with-custom-ordering">SQL Quick Tip: Present Cleaner Results with Custom Ordering</a>
              </h3>
              
              <time class="published" datetime='2019-08-30'>
                August 30, 2019
              </time>
            </header>
            

          </article>
        
      </div>

      
        <a href=
          
            /post/
          
        class="button">View more posts</a>
      
    </div>
  </section>

  
  
  
  
    <section id="categories">
      <header>
        <h3>
          <a href="/categories/">Categories</a>
        </h3>
      </header>
        
          
        

        
        <p>
          <article>
            <header>
              
                <a href="/categories/tai-chi/">Tai Chi</a>
                <span style="float:right;">85</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/qigong/">Qigong</a>
                <span style="float:right;">74</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/code/">Code</a>
                <span style="float:right;">38</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/movement-practice/">Movement Practice</a>
                <span style="float:right;">33</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/small-business/">Small Business</a>
                <span style="float:right;">21</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/inner-form/">Inner Form</a>
                <span style="float:right;">14</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/practice-people/">Practice People</a>
                <span style="float:right;">12</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/practice-tip/">Practice Tip</a>
                <span style="float:right;">10</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/launch-academy/">Launch Academy</a>
                <span style="float:right;">9</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/psychology/">Psychology</a>
                <span style="float:right;">9</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/sql/">SQL</a>
                <span style="float:right;">9</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/btc/">BTC</a>
                <span style="float:right;">5</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/events/">Events</a>
                <span style="float:right;">5</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/quick-tip/">Quick Tip</a>
                <span style="float:right;">5</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/site/">Site</a>
                <span style="float:right;">5</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/trainerfly/">Trainerfly</a>
                <span style="float:right;">5</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/bigquery/">BigQuery</a>
                <span style="float:right;">3</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/energy-arts/">Energy Arts</a>
                <span style="float:right;">3</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/twilio/">Twilio</a>
                <span style="float:right;">3</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/golang/">Golang</a>
                <span style="float:right;">2</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/octopress/">Octopress</a>
                <span style="float:right;">2</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/rails/">Rails</a>
                <span style="float:right;">2</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/ruby/">Ruby</a>
                <span style="float:right;">2</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/static-sites/">Static Sites</a>
                <span style="float:right;">2</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/courses-and-events/">Courses and Events</a>
                <span style="float:right;">1</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/learning/">Learning</a>
                <span style="float:right;">1</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/meditation/">Meditation</a>
                <span style="float:right;">1</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/railsconf/">RailsConf</a>
                <span style="float:right;">1</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/security/">Security</a>
                <span style="float:right;">1</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/sinatra/">Sinatra</a>
                <span style="float:right;">1</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/xing-yi/">Xing Yi</a>
                <span style="float:right;">1</span>
              
            </header>
          </article>
        </p>
        
    </section>
  

  
  

  
  <section id="footer">
    
      <ul class="icons">
        
          <li>
            <a href="" type="application/rss+xml" target="_blank" title="RSS" class="fa fa-rss"></a>
          </li>
        
        
  <li><a href="//github.com/dankleiman" target="_blank" title="GitHub" class="fa fa-github"></a></li>

























  <li><a href="//linkedin.com/in/dlkleiman" target="_blank" title="LinkedIn" class="fa fa-linkedin"></a></li>













  <li><a href="//reddit.com/user/upalready" target="_blank" title="Reddit" class="fa fa-reddit"></a></li>





















  <li><a href="//twitter.com/Dan_Kleiman" target="_blank" title="Twitter" class="fa fa-twitter"></a></li>













  <li><a href="mailto:info@dankleiman.com" title="Email" class="fa fa-envelope"></a></li>


      </ul>
    
    <p class="copyright">
      
        &copy; 2019
        
          Dan Kleiman
        
      .
      Powered by <a href="//gohugo.io" target="_blank">Hugo</a>
    </p>
  </section>
</section>

    </div>
    <a id="back-to-top" href="#" class="fa fa-arrow-up fa-border fa-2x"></a>
    

    
      
    

    
    
      <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/skel/3.0.1/skel.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.25/jquery.fancybox.min.js"></script>
      <script src="https://dankleiman.com/js/util.js"></script>
      <script src="https://dankleiman.com/js/main.js"></script>
      <script src="https://dankleiman.com/js/backToTop.js"></script>
    

    
      
        
      
    

    
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

